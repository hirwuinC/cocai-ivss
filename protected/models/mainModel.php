<?php   class mainModel extends Model{    protected $query;    public function __construct(){      parent::__construct();    }    public function __destruct(){      ;    }   public function Gets($tabla = false, $item = false, $valor = false, $modelo = false){             switch ($tabla) {        case 'referencia':         if ($item == 'padre_id') {            $query = "SELECT ref.id, ref.referencia from referencia inner join referencia as ref on ref.padre_id = referencia.id where ref.padre_id = '".$valor."' ORDER BY ref.referencia";          }else if($item == 'sub_modelo'){              $query = "SELECT ref.id, ref.referencia from referencia inner join referencia as ref on ref.padre_id = referencia.id where ref.padre_id = '".$valor."' and ref.referencia not in ('TP','CK','MF','FP','RB','PL','OH','Sin asignar')";          } else{            $query = "SELECT ref.id, ref.referencia from referencia  inner join referencia ref on ref.padre_id = referencia.id where referencia.referencia = '".$item."' ";          }            /*$query = "SELECT referencia.id, ref.id, referencia.referencia, ref.referencia from referencia inner join referencia as ref on ref.padre_id = referencia.id where ref.padre_id = '".$valor."'";*/          break;        case 'unidad_negocio':           //echo $item;            if ($item == 'modelo_id') {              $query="SELECT unidad_negocio.id, unidad_negocio.nombreC, unidad_negocio.codigo, unidad_negocio.numero_autorizacion, referencia.referencia as division, ref.referencia as modelo from unidad_negocio inner join referencia on unidad_negocio.division_id = referencia.id LEFT join referencia as ref on unidad_negocio.modelo_id = ref.id where unidad_negocio.".$item." = '".$valor."'";            }else if($item == 'division_id'){             // echo "full services funciona";              $query = "SELECT unidad_negocio.id, unidad_negocio.nombreC, unidad_negocio.codigo,  unidad_negocio.numero_autorizacion, referencia.referencia as division, ref.referencia as modelo from unidad_negocio               inner join referencia on unidad_negocio.division_id = referencia.id              LEFT join referencia as ref on unidad_negocio.modelo_id = ref.id              where unidad_negocio.".$item." = '".$valor."'";               }                    break;        case 'grupo':                    if ($item == 'familia' || $item == 'familias' or $item == 'familia2' or $item == 'familia1') {            //echo "string <br>";            $query = "SELECT * FROM grupo where padre_id = 1";          }else if($item == 'grupo1' || $item == 'grupos' || $item == 'grupo'){            $query = "SELECT * FROM grupo where submodelo_id = $modelo";          }else if($valor = false){            $query = "SELECT * FROM grupo";          }        break;        case 'producto':           $query = "SELECT id, nombre, codigo FROM `producto` WHERE grupo_id = $valor";          break;        case 'unidad_medida':          if ($modelo == '30') {            $query = "SELECT * from unidad_medida where unidad_medida.abreviatura is not null and unidad not in('Fardo','Guacal','Saco','caja','Fardo','Guacal','Botella','Lata','Resma','Docena','Frasco','Cuenta','Bandeja','cuñete','Barra','Bulto','Bovina','Paquete')";          }          else if ($item == 'unidad_medida_si') {            $query = "SELECT * from unidad_medida where unidad_medida.abreviatura is not null and padre_id = $modelo  and unidad not in('Fardo','Guacal','Saco','caja','Fardo','Guacal','Botella','Lata','Resma','Docena','Frasco','Cuenta','Bandeja','cuñete','Barra','Bulto','Bovina','Paquete')";          }else{            $query = "SELECT * from unidad_medida where unidad_medida.abreviatura is not null";          }                  break;                default:           $query = "SELECT * FROM ".$tabla." where ".$item." = '".$valor."'";          break;      }                  $auxiliar = $this->_db->query($query);        try {        $this->_db->beginTransaction();        $result= $auxiliar->fetchAll();        $this->_db->commit();        }        catch (Exception $e){                    $this->_db-rollBack();          echo "Error :: ".$e->getMessage();          exit();                  }      //  echo $result[1][1];        return $result;                }    public function select($query){            $auxiliar = $this->_db->query($query);        try {        $this->_db->beginTransaction();        $result= $auxiliar->fetchAll();        $this->_db->commit();        }        catch (Exception $e){                    $this->_db-rollBack();          echo "Error :: ".$e->getMessage();          exit();                  }                return $result;          }    public function insertar($query, $tabla=false){      //var_dump($query);      //exit();      try {        $this->_db->beginTransaction();        $this->_db->prepare($query)->execute();        $id =  $this->_db->lastinsertid($tabla);        $this->_db->commit();      }      catch (Exception $e){        $this->_db->rollBack();        echo "Error :: ".$e->getMessage();        exit();      }      return $id;    }    public function totalRegistros($query){      //echo $query;      $auxiliar = $this->_db->query($query);        try {        $this->_db->beginTransaction();        $result= $auxiliar->fetchAll();        $numFila = $auxiliar->rowCount();        $this->_db->commit();        }        catch (Exception $e){                    $this->_db-rollBack();          echo "Error :: ".$e->getMessage();          exit();                  }            $result = $numFila;        return $result;    }    public function modificar($query){      //var_dump($query);       try {        $this->_db->beginTransaction();        //$this->_db->prepare($query);        $result=$this->_db->exec($query);        $this->_db->commit();              }      catch (Exception $e){        $this->_db->rollBack();        echo "Error :: ".$e->getMessage();        exit();      }    return $result;    }    public function eliminar($query){      try {        $this->_db->beginTransaction();        //$this->_db->prepare($query);        $result=$this->_db->exec($query);        $this->_db->commit();      }      catch (Exception $e){        $this->_db->rollBack();        echo "Error :: ".$e->getMessage();        exit();      }    return $result;    }   /* public function productosSinUsar($codigoPadre){      $string = " ";      try {      $this->_db->beginTransaction();      $query = "SELECT nombre FROM combo where codigoPadre = ".$codigoPadre."";      $auxiliar = $this->_db->query($query);      $resultado = $auxiliar->fetchAll();      for ($i=0; $i < count($resultado) ; $i++) {          $aux[$i]= $resultado[$i]['nombre'];         $cadena = "and profesor_id != $aux[$i] ";         $string = $string.$cadena;              }         $query = "SELECT DISTINCT producto.nombre as 'producto', grupo.nombre as 'grupo' FROM producto           where referencia.id = ".$carrera." and (materia_id != ".$materia." or materia_id is null) ".$string;       $auxiliar2 = $this->_db->query($query);       $result2= $auxiliar2->fetchAll();                      //Controller::Vardump($result2);        $this->_db->commit();        }        catch (Exception $e){                    $this->_db-rollBack();          echo "Error :: ".$e->getMessage();          exit();                  }                return $result2;          } */      }?>